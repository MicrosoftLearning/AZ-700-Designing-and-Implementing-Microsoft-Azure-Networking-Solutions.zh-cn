---
Exercise:
    title: '模块 1 第 6 单元 - 在 Azure 中配置 DNS 设置'
    module: '模块 - Azure 虚拟网络简介'
---

# 模块 01 第 6 单元 - 在 Azure 中配置 DNS 设置

## 练习场景 
在本单元，你将为 Contoso 有限公司配置 DNS 名称解析。你将创建名为 contoso.com 的专用 DNS 区域，为注册和解析链接 VNet，然后创建两个虚拟机并测试配置。

在本练习中，你将：

+ 任务 1：创建专用 DNS 区域
+ 任务 2：为自动注册链接子网
+ 任务 3：创建虚拟机以测试配置
+ 任务 4：验证记录是否出现在 DNS 区域中


## 任务 1：创建专用 DNS 区域

1. 转到 [Azure 门户](https://portal.azure.com/)。

2. 在 Azure 主页的搜索栏中，键入 dns，然后选择“**专用 DNS 区域**”。  
   ‎![具有 dns 搜索的 Azure 门户主页。](../media/create-private-dns-zone.png)

3. 在专用 DNS 区域中，选择“**+ 创建**”。

4. 使用下表中的信息创建专用 DNS 区域。

| **选项卡**         | **选项**                             | **值**            |
| --------------- | -------------------------------------- | -------------------- |
| 基本          | 资源组                         | ContosoResourceGroup |
|                 | 名称                                   | Contoso.com          |
| 标记            | 无需任何更改                    |                      |
| 查看 + 创建 | 检查设置，然后选择“创建” |                      |


5. 等待部署完成，然后选择“**前往资源**”。

6. 验证是否已创建区域。

## 任务 2：为自动注册链接子网

1. 在 Contoso.com 中的“**设置**”下，选择“**虚拟网络链接**”。

2. 在 Contoso.com | 虚拟网络链接中，选择“**+ 添加**”。

![contoso.com | 突出显示“+ 添加”的虚拟链接。](../media/add-network-link-dns.png)

3. 使用下表中的信息添加虚拟网络链接。

| **选项**                          | **值**                               |
| ----------------------------------- | --------------------------------------- |
| 链接名称                           | CoreServicesVnetLink                    |
| 订阅                        | 无需任何更改                     |
| 虚拟网络                     | CoreServicesVnet (ContosoResourceGroup) |
| 启用自动注册            | 已选择                                |
| 检查设置，然后选择“确定”。 |                                         |


4. 选择“**刷新**”。

5. 验证是否已创建 CoreServicesVnetLink，是否启用了该自动注册。

6. 使用以下表中的信息，为 ManufacturingVnet 重复步骤 2 - 5： 

| **选项**                          | **值**                                |
| ----------------------------------- | ---------------------------------------- |
| 链接名称                           | ManufacturingVnetLink                    |
| 订阅                        | 无需任何更改                      |
| 虚拟网络                     | ManufacturingVnet (ContosoResourceGroup) |
| 启用自动注册            | 已选择                                 |
| 检查设置，然后选择“确定”。 |                                          |


7. 选择“**刷新**”。

8. 验证是否已创建 ManufacturingVnetLink，是否启用了该自动注册。

9. 使用以下表中的信息，为 ResearchVnet 重复步骤 2 - 5： 

| **选项**                          | **值**                           |
| ----------------------------------- | ----------------------------------- |
| 链接名称                           | ResearchVnetLink                    |
| 订阅                        | 无需任何更改                 |
| 虚拟网络                     | ResearchVnet (ContosoResourceGroup) |
| 启用自动注册            | 已选择                            |
| 检查设置，然后选择“确定”。 |                                     |


10. 选择“**刷新**”。

11. 验证是否已创建 ResearchVnetLink，是否启用了该自动注册。

 

##  任务 3：创建虚拟机以测试配置

在本部分中，你将创建两个测试 VM，以测试专用 DNS 区域配置。

### 创建 TestVM1

1. 在 Azure 主页上，使用全局搜索类型“**虚拟机**”并选择服务下的虚拟机。

2. 在虚拟机中，选择“**+ 创建; + 虚拟机**”。

3. 使用下表中的信息创建你的第一个 VM。

| **选项卡**         | **选项**                                                   | **值**                             |
| --------------- | ------------------------------------------------------------ | ------------------------------------- |
| 基本          | 资源组                                               | ContosoResourceGroup                  |
|                 | 虚拟机名称                                         | 中的机器人 TestVM1                               |
|                 | 区域                                                       | 美国东部                               |
|                 | 可用性选项                                         | 无需基础结构冗余 |
|                 | 映像                                                        | Windows Server 2022 Datacenter- Gen1  |
|                 | Azure Spot 实例                                          | 未选择                          |
|                 | 大小                                                         | Standard_D2s_v3 - 2vcpus，8GiB 内存 |
|                 | 用户名                                                     | TestUser                              |
|                 | 密码                                                     | TestPa$$w0rd!                         |
|                 | 公共入站端口                                         | 允许选定的端口                  |
|                 | 选择入站端口                                         | RDP (3389)                            |
| 磁盘           | 无需任何更改                                          |                                       |
| 网络      | 虚拟网络                                              | CoreServicesVnet                      |
|                 | 子网                                                       | DatabaseSubnet (10.20.20.0/24)        |
|                 | 公共 IP                                                    | （新）TestVM1-ip                      |
|                 | NIC 网络安全组                                   | 基本                                 |
|                 | 公共入站端口                                         | 允许选定的端口                  |
|                 | 选择入站端口                                         | RDP (3389)                            |
|                 | 负载均衡                                               | 未选择                          |
| 管理      | 无需任何更改                                          |                                       |
| 高级        | 无需任何更改                                          |                                       |
| 标记            | 无需任何更改                                          |                                       |
| 查看 + 创建 | 检查设置，然后选择“创建”                       |                                       |


4. 部署正在进行时，你可以继续创建 TestVM2。

### 创建 TestVM2

1. 在 Azure 主页上，使用全局搜索类型“**虚拟机**”并选择服务下的虚拟机。

2. 在虚拟机中，选择“**+ 创建; + 虚拟机**”。

3. 使用下表中的信息创建你的第二个 VM。

| **选项卡**         | **选项**                                                   | **值**                             |
| --------------- | ------------------------------------------------------------ | ------------------------------------- |
| 基本          | 资源组                                               | ContosoResourceGroup                  |
|                 | 虚拟机名称                                         | 中的机器人 TestVM2                               |
|                 | 区域                                                       | 美国东部                               |
|                 | 可用性选项                                         | 无需基础结构冗余 |
|                 | 映像                                                        | Windows Server 2022 Datacenter- Gen1  |
|                 | Azure Spot 实例                                          | 未选择                          |
|                 | 大小                                                         | Standard_D2s_v3 - 2vcpus，8GiB 内存 |
|                 | 用户名                                                     | TestUser                              |
|                 | 密码                                                     | TestPa$$w0rd!                         |
|                 | 公共入站端口                                         | 允许选定的端口                  |
|                 | 选择入站端口                                         | RDP (3389)                            |
| 磁盘           | 无需任何更改                                          |                                       |
| 网络      | 虚拟网络                                              | CoreServicesVnet                      |
|                 | 子网                                                       | DatabaseSubnet (10.20.20.0/24)        |
|                 | 公共 IP                                                    | （新）TestVM2-ip                      |
|                 | NIC 网络安全组                                   | 基本                                 |
|                 | 公共入站端口                                         | 允许选定的端口                  |
|                 | 选择入站端口                                         | RDP (3389)                            |
|                 | 负载均衡                                               | 未选择                          |
| 管理      | 无需任何更改                                          |                                       |
| 高级        | 无需任何更改                                          |                                       |
| 标记            | 无需任何更改                                          |                                       |
| 查看 + 创建 | 检查设置，然后选择“**创建**”                   |                                       |


4. 完成部署后，转到 Azure 门户主页，然后选择“**虚拟机**”。

5. 验证是否已创建两个虚拟机。

 

## 任务 4：验证记录是否出现在 DNS 区域中

1. 在 Azure 门户主页上，选择“**专用 DNS 区域**”。

2. 在专用 DNS 区域中，选择“**contoso.com**”。

3. 验证是否已为两个 VM 列出主机 (A) 记录，如下所示：

![Contoso.com DNS 区域显示自动注册的主机 A 记录。](../media/contoso_com-dns-zone.png)

 

4. 记下 VM 的名称和 IP 地址。

 

### 使用 RDP 连接到测试 VM

1. 在 Azure 门户主页上，选择“**虚拟机**”。

2. 选择“**TestVM1**”。

3. 在 TestVM1 中，选择“**连接**” > “**RDP**”。

![突出显示“连接”和“RDP”的 TestVM1。](../media/connect-to-am.png)

4. 在“TestVM1 | 连接”中，选择“**下载 RDP 文件**”。

5. 将 RDP 文件保存到桌面。

6. 在 Azure 门户主页上，选择“**虚拟机**”。

7. 选择“**TestVM2**”。

8. 在 TestVM2 中，选择“**连接**” > “**RDP**”。

9. 在 TestVM2 | 连接”中，选择 “**下载 RDP 文件**”。

10. 将 RDP 文件保存到桌面。

11. 使用 RDP 文件、用户名 **TestUser** 和密码 **TestPa$w0rd!** 连接到 TestVM1。

12. 使用 RDP 文件、用户名 **TestUser** 和密码 **TestPa$w0rd!** 连接到 TestVM2。

13. 在两个 VM 上的“**为设备选择隐私设置**”中，选择“**接受**”。

14. 如果出现提示，在两个 VM 上的“**网络**”中，选择“**是**”。

15. 在 TestVM1 上，打开命令提示符，并输入命令 ipconfig /all。

16. 验证 IP 地址是否与你在 DNS 区域中备注的 IP 地址相同。

17. 输入命令 ping TestVM2.contoso.com。

18. 验证是否收到 TestVM2 的四个副本。

 

恭喜！你已创建了专用 DNS 区域，添加了解析和自动注册链接，并测试了配置中的名称解析。 
